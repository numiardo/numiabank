<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NumiaBank - Innova tu banca</title>
  <!-- FAVICON para la pestaña -->
  <link rel="icon" type="image/png" href="images/N.png" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <!-- Google Font Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    /* --- Variables de color --- */
    :root {
      --numia-azul: #863DFF;
      --numia-azul-claro: #e6ecf9; /* para fondos suaves */
      --numia-azul-muy-claro: #eef2fc; /* para segunda franja */
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: #f7f7f7;
    }
    .card.ad-card {
      border-radius: 1.2rem;
      box-shadow: 0 4px 18px rgba(0,0,0,0.08);
      transition: transform 0.18s, box-shadow 0.18s;
      min-width: 210px;
      min-height: 380px;
      display: flex;
      flex-direction: column;
      justify-content: stretch;
      height: 100%;
    }
    .card.ad-card:hover {
      transform: translateY(-4px) scale(1.025);
      /* sombra adaptada al azul */
      box-shadow: 0 8px 32px rgba(0,19,145,0.17);
    }
    .card-img-top-holder {
      width: 100%;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #fff8f8;
      border-top-left-radius: 1.2rem;
      border-top-right-radius: 1.2rem;
    }
    .card-img-top-holder img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      transition: transform 0.3s;
    }
    .ad-card .card-body {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      height: 100%;
      padding-bottom: 1.5rem;
    }
    .ad-card .card-title {
      font-weight: 700;
      color: var(--numia-azul);
      font-size: 1.25rem;
      margin-bottom: .25rem;
      margin-top: 1rem;
      min-height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .ad-card .card-text {
      font-size: 1.01rem;
      color: #2d2d2d;
      font-weight: 500;
      opacity: 0.88;
      margin-bottom: 1.1rem;
      min-height: 56px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .carousel-item img {
      object-fit: cover;
      width: 100%;
      height: 340px;
      border-radius: 0.7rem;
    }
    @media (max-width: 991px) {
      .main-cards .col-lg-3 {
        flex: 0 0 50%;
        max-width: 50%;
        margin-bottom: 1rem;
      }
      .carousel-item img {
        height: 180px;
      }
    }
    @media (max-width: 767px) {
      .main-cards .col-lg-3 {
        flex: 0 0 100%;
        max-width: 100%;
      }
      .carousel-item img {
        height: 140px;
      }
      .card-img-top-holder {
        height: 140px;
      }
      .ad-card .card-title { font-size: 1.08rem; }
    }

    /* --- Sección de Divisas/Tasas --- */
    .rates-section {
      display: flex;
      gap: 2.2rem;
      align-items: stretch;
      margin: 36px 0 0 0;
      width: 100%;
      flex-wrap: wrap;
    }
    .rates-col-table {
      background: #fff;
      border-radius: 1.1rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      padding: 2.1rem 1.6rem 1.6rem 1.7rem;
      min-width: 340px;
      flex: 2 1 540px;
      max-width: 1000px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
    }
    .rates-col-side {
      background: #fff;
      border-radius: 1.1rem;
      box-shadow: 0 2px 12px rgba(0,0,0,0.07);
      padding: 2.1rem 1.6rem 1.6rem 1.7rem;
      min-width: 220px;
      flex: 1 1 320px;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
    }
    .rates-col-side .bi {
      font-size: 2.6rem;
      color: var(--numia-azul);
      margin-bottom: .7rem;
    }
    .rates-col-side h5 {
      color: var(--numia-azul);
      font-weight: 700;
      margin-bottom: .5rem;
      font-size: 1.2rem;
    }
    .rates-col-side p {
      color: #444;
      font-size: 1.07rem;
      font-weight: 500;
      margin-bottom: 1.2rem;
      opacity: .93;
    }
    .rates-col-side .btn {
      /* usamos el azul numia como fondo */
      background: var(--numia-azul);
      border: none;
      color: #fff;
      font-weight: 700;
      border-radius: 24px;
      padding: 0.7rem 2.1rem;
      font-size: 1.07rem;
      box-shadow: 0 2px 7px rgba(0,19,145,0.06);
      transition: background 0.18s;
    }
    .rates-col-side .btn:hover {
      /* ligero oscurecimiento */
      background: #000d73;
      color: #fff;
    }

    /* --- Botones de pestañas Divisas/Tasas --- */
    .rates-tab-btn {
      padding: .7rem 0;
      border: none;
      border-radius: 9px;
      font-weight: bold;
      font-size: 1.1rem;
      background: #fff;
      color: var(--numia-azul);
      margin-bottom: 0;
      transition: background .16s, color .16s;
      cursor: pointer;
      box-shadow: none;
      outline: none;
      border: 2px solid #d1d9f9; /* borde muy claro */
      min-width: 70px;
    }
    .rates-tab-btn.active,
    .rates-tab-btn:focus {
      background: var(--numia-azul);
      color: #fff;
      border: 2px solid var(--numia-azul);
    }

    /* --- Tabla de tasas/divisas --- */
    .rates-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: #fff;
      border-radius: 0.8rem;
      overflow: hidden;
      margin-top: 0.7rem;
    }
    .rates-table th,
    .rates-table td {
      padding: 12px 18px;
      font-size: 1.04rem;
      text-align: left;
    }
    .rates-table th {
      color: var(--numia-azul);
      background: var(--numia-azul-claro);
      border: none;
      font-size: 1.08rem;
      font-weight: 700;
      text-align: center;
      letter-spacing: 0.02em;
    }
    .rates-table tr:not(:last-child) {
      border-bottom: 1px solid #cde0f8;
    }
    .rates-table tr:nth-child(2) {
      background: var(--numia-azul-claro);
    }
    .rates-table tr:nth-child(3) {
      background: var(--numia-azul-muy-claro);
    }
    .rates-table td {
      color: #222;
      font-weight: 500;
      text-align: center;
      vertical-align: middle;
    }
    .rates-table td:first-child,
    .rates-table th:first-child {
      text-align: left;
    }

    @media (max-width: 1300px) {
      .rates-col-table {
        min-width: 0;
        flex-basis: 400px;
      }
      .rates-col-side {
        min-width: 0;
      }
    }
    @media (max-width: 991px) {
      .rates-section {
        flex-direction: column;
        gap: 1.4rem;
      }
      .rates-col-table,
      .rates-col-side {
        min-width: 0;
        max-width: 100%;
      }
      .rates-col-side {
        align-items: flex-start;
        padding-top: 1.2rem;
      }
    }

    /* --- Estilos específicos para botones y elementos que antes eran 'rojos' --- */
    /* Creamos una clase para forzar que btn-primary use nuestro azul */
    .btn-primary {
      background-color: var(--numia-azul) !important;
      border-color: var(--numia-azul) !important;
    }
    .btn-primary:hover {
      background-color: #000d73 !important;
      border-color: #000d73 !important;
    }
    .btn-outline-primary {
      color: var(--numia-azul) !important;
      border-color: var(--numia-azul) !important;
    }
    .btn-outline-primary:hover {
      background-color: var(--numia-azul) !important;
      color: #fff !important;
    }

    /* Cambiamos el icono de maximizar del chat para que destaque sobre azul */
    #max-chat {
      background: var(--numia-azul) !important;
    }
    #open-chat {
      background: var(--numia-azul) !important;
    }

    /* ======== UX citas mejorado ======== */
    #modalCita .modal-dialog { max-width: 920px; }
    #modalCita .modal-content { border-radius: 16px; border: 0; box-shadow: 0 14px 40px rgba(0,0,0,.12); }
    #modalCita .modal-header { border-bottom: 1px solid #eef2fc; }
    #modalCita .modal-body { padding-top: .75rem; }

    .cita-toolbar {
      position: sticky; top: 0; z-index: 2; background: #fff;
      padding-bottom: .5rem; margin-bottom: .75rem; border-bottom: 1px solid #eef2fc;
    }
    #citaSchedule, #citaBranch, #citaFecha { border-radius: 10px; }
    #citaSlots {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(88px, 1fr));
      gap: .5rem;
      max-height: 320px;
      overflow: auto;
      padding-right: .25rem;
    }
    #citaSlots .btn {
      border-radius: 10px;
      border: 1px solid #c9b6ff;
      font-weight: 600;
      padding: .45rem .3rem;
    }
    #citaSlots .btn:hover { background: #f6f3ff; }
    #citaSlots .btn.active,
    #citaSlots .btn:focus {
      background: var(--numia-azul);
      color: #fff;
      border-color: var(--numia-azul);
    }
    .cita-legend { font-size: .8rem; color: #6c6c7a; }

    @media (max-width: 576px) {
      #citaSlots { max-height: 260px; }
    }
  </style>
</head>
<body class="d-flex flex-column min-vh-100">

  <!-- Encabezado con logos -->
  <header class="bg-white shadow-sm py-2 mb-0">
    <div class="container">
      <div class="d-flex justify-content-between align-items-right">
        <a href="index.html" class="d-block">
          <img src="images/numia.png" alt="Numia Bank Logo" class="img-fluid" style="max-height: 88px;" />
        </a>
        <!-- Cambiamos logo_hsbc por logo_numia -->
      </div>
      <p class="lead mt-2 mb-0 text-dark text-start" style="font-size:1rem;">
        Innovación en tus finanzas, potenciada por IA manteniendo el toque humano
      </p>
    </div>
  </header>

  <!-- NAVBAR de menús principal debajo del header -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm border-bottom" style="z-index:1050;">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-center" id="navbarMain">
        <ul class="navbar-nav mb-2 mb-lg-0">
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="cuentasDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-wallet2 me-1"></i>Cuentas
            </a>
            <ul class="dropdown-menu" aria-labelledby="cuentasDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-phone me-2"></i>Cuenta Digital</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-cash-coin me-2"></i>Cuenta Nómina</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-emoji-smile me-2"></i>Cuenta Kids</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="tarjetasDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-credit-card-2-front me-1"></i>Tarjetas
            </a>
            <ul class="dropdown-menu" aria-labelledby="tarjetasDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-credit-card-2-front me-2"></i>Crédito</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-credit-card me-2"></i>Débito</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-card-heading me-2"></i>Prepagada</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="creditosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-cash-stack me-1"></i>Créditos
            </a>
            <ul class="dropdown-menu" aria-labelledby="creditosDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-currency-dollar me-2"></i>Préstamo Personal</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-car-front me-2"></i>Crédito de Auto</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-house-door me-2"></i>Crédito Hipotecario</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="inversionesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-bar-chart-line me-1"></i>Inversiones
            </a>
            <ul class="dropdown-menu" aria-labelledby="inversionesDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-piggy-bank me-2"></i>CETES</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-graph-up-arrow me-2"></i>Fondos de Inversión</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-calendar2-week me-2"></i>Plazo Fijo</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown px-2">
            <a class="nav-link dropdown-toggle fw-semibold" href="#" id="segurosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-shield-check me-1"></i>Seguros
            </a>
            <ul class="dropdown-menu" aria-labelledby="segurosDropdown">
              <li><a class="dropdown-item" href="#"><i class="bi bi-truck-front me-2"></i>Auto</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-heart-pulse me-2"></i>Vida</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-hospital me-2"></i>Gastos Médicos</a></li>
              <li><a class="dropdown-item" href="#"><i class="bi bi-house-heart me-2"></i>Hogar</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Carrusel de imágenes -->
  <div class="container mb-4">
    <div id="carouselMain" class="carousel slide shadow-sm rounded-3" data-bs-ride="carousel">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="images/Carrusel 1.png" class="d-block w-100" alt="Promo 1">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="fw-bold display-6" style="text-shadow: 0 2px 12px rgba(0,0,0,0.36)">¡Lo más hot!</h5>
            <p class="fs-4">Usa tu tarjeta de crédito digital y recibe hasta un <strong>20% de cashback</strong></p>
            <!-- Cambiado btn-danger a btn-primary -->
            <a href="#" class="btn btn-primary btn-lg rounded-pill mt-2 px-4 fw-bold">Conoce más</a>
          </div>
        </div>
        <div class="carousel-item">
          <img src="images/Carrusel 2.png" class="d-block w-100" alt="Promo 2">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="fw-bold display-6">Banca digital</h5>
            <p class="fs-4">Accede a tu banca en línea y administra tus productos 24/7</p>
            <!-- Este botón era outline-light, lo dejamos como está -->
            <a href="#" class="btn btn-outline-light btn-lg rounded-pill mt-2 px-4 fw-bold">Regístrate aquí</a>
          </div>
        </div>
        <div class="carousel-item">
          <img src="images/Carrusel 3.png" class="d-block w-100" alt="Promo 3">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="fw-bold display-6">Préstamos numia</h5>
            <p class="fs-4">Consolida tus deudas y obtén las mejores tasas del mercado</p>
            <!-- Cambiado btn-danger a btn-primary -->
            <a href="#" class="btn btn-primary btn-lg rounded-pill mt-2 px-4 fw-bold">Simula tu crédito</a>
          </div>
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselMain" data-bs-slide="prev">
        <span class="carousel-control-prev-icon bg-dark rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselMain" data-bs-slide="next">
        <span class="carousel-control-next-icon bg-dark rounded-circle" aria-hidden="true"></span>
        <span class="visually-hidden">Siguiente</span>
      </button>
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselMain" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselMain" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselMain" data-bs-slide-to="2" aria-label="Slide 3"></button>
      </div>
    </div>
  </div>

  <!-- TARJETAS -->
  <main class="container mb-5">
    <div class="row g-4 justify-content-center main-cards">
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/Tarjeta de credito.jpg" alt="Tarjeta de Crédito">
          </div>
          <div class="card-body">
            <h5 class="card-title">Agenda una cita</h5>
            <p class="card-text">Agenda una cita con un agente especialista y recibe atención remota o presencial.</p>
            <!-- Cambiado btn-danger a btn-primary -->
            <button class="btn btn-primary rounded-pill px-4 mt-2 fw-bold" disabled>Agendar</button>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/Apertura de cuenta.png" alt="Cuenta Nómina">
          </div>
          <div class="card-body">
            <h5 class="card-title">Apertura de cuenta nómina</h5>
            <p class="card-text">Recibe tu sueldo y accede a promociones, descuentos y retiros sin costo en miles de cajeros.</p>
            <!-- Cambiado btn-outline-danger a btn-outline-primary -->
            <button class="btn btn-outline-primary rounded-pill px-4 mt-2 fw-bold" disabled>Comenzar</button>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/Prestamo personal.png" alt="Préstamo Personal">
          </div>
          <div class="card-body">
            <h5 class="card-title">Préstamos personales</h5>
            <p class="card-text">Soluciona, planea y disfruta: obtén tu préstamo con tasas preferenciales y pagos flexibles.</p>
            <!-- Cambiado btn-danger a btn-primary -->
            <button class="btn btn-primary rounded-pill px-4 mt-2 fw-bold" disabled>Simular préstamo</button>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6">
        <div class="card ad-card h-100 text-center">
          <div class="card-img-top-holder">
            <img src="images/seguros.png" alt="Seguros numia">
          </div>
          <div class="card-body">
            <h5 class="card-title">Seguros numia</h5>
            <p class="card-text">Tu tranquilidad asegurada: protege auto, hogar, salud y vida con la solidez de numia.</p>
            <!-- Cambiado btn-outline-danger a btn-outline-primary -->
            <button class="btn btn-outline-primary rounded-pill px-4 mt-2 fw-bold" disabled>Conoce más</button>
          </div>
        </div>
      </div>
    </div>

    <!-- NUEVA SECCION: DIVISAS/TASAS + INVERSIONES -->
    <div class="rates-section mt-5 mb-4">
      <div class="rates-col-table">
        <div class="d-flex gap-3 mb-2">
          <button class="rates-tab-btn active" id="tabDivisas" onclick="showRatesTab('divisas')">Divisas</button>
          <button class="rates-tab-btn" id="tabTasas" onclick="showRatesTab('tasas')">Tasas</button>
        </div>
        <table class="rates-table" id="tablaDivisas">
          <thead>
            <tr>
              <th>Divisa</th>
              <th>Compra</th>
              <th>Venta</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Dólar USD</td>
              <td>17.12</td>
              <td>17.45</td>
            </tr>
            <tr>
              <td>Euro</td>
              <td>18.65</td>
              <td>19.15</td>
            </tr>
            <tr>
              <td>Libra esterlina</td>
              <td>21.15</td>
              <td>21.75</td>
            </tr>
          </tbody>
        </table>
        <table class="rates-table" id="tablaTasas" style="display:none;">
          <thead>
            <tr>
              <th></th>
              <th>Tasa Bruta al<br><span style="font-size:1rem;font-weight:700;">02/06/2025</span></th>
              <th>Tasa Bruta<br>Anual</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>cete Diario</td>
              <td>8.12 %</td>
              <td>9.18 %</td>
            </tr>
            <tr>
              <td>cete Anualizado</td>
              <td>8.12 %</td>
              <td>9.18 %</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="rates-col-side">
        <i class="bi bi-piggy-bank"></i>
        <h5 class="mb-1" style="font-weight:700;">Tus inversiones Numia</h5>
        <p>
          <strong>Saldo CETES:</strong> $75,000.00 MXN<br>
          <span style="font-size:0.95rem; color:var(--numia-azul); font-weight:700;">¡Estás generando $570/mes solo en intereses!</span>
        </p>
        <p>
          ¿Quieres diversificar? Simula en 2 clicks tus ganancias potenciales en fondos de inversión o plazo fijo.
        </p>
        <button class="btn" disabled>Invertir ahora</button>
      </div>
    </div>
  </main>

  <!-- Pie de página con mt-auto para pegarlo al fondo -->
  <footer class="bg-light text-center py-3 mt-auto border-top">
    <small>&copy; NumiaBank. Todos los derechos reservados.</small>
  </footer>

  <!-- ===================== MODAL DE CITAS (AGREGADO) ===================== -->
  <div class="modal fade" id="modalCita" tabindex="-1" aria-labelledby="modalCitaLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalCitaLabel">
            <i class="bi bi-calendar2-week me-2"></i>Agenda tu cita
          </h5>
          <button class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>

        <div class="modal-body">
          <div id="citaAlert" class="alert d-none"></div>

          <!-- Barra superior pegajosa con selects + fecha + chips -->
          <div class="cita-toolbar">
            <div class="row g-3 align-items-end">
              <div class="col-lg-4">
                <label class="form-label fw-semibold">Servicio / Agenda</label>
                <select id="citaSchedule" class="form-select">
                  <option value="">Cargando...</option>
                </select>
              </div>
              <div class="col-lg-4">
                <label class="form-label fw-semibold">Sucursal</label>
                <select id="citaBranch" class="form-select" disabled>
                  <option value="">Selecciona un servicio</option>
                </select>
              </div>
              <div class="col-lg-4">
                <label class="form-label fw-semibold">Fecha</label>
                <div class="d-flex gap-2">
                  <input id="citaFecha" type="date" class="form-control" disabled/>
                </div>
              </div>
            </div>
          </div>

          <!-- Grid de horarios con scroll interno -->
          <div class="mb-3">
            <label class="form-label fw-semibold">Horarios disponibles</label>
            <div id="citaSlots"></div>
          </div>

          <hr class="my-3">

          <!-- Datos del cliente -->
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Nombre</label>
              <input id="citaFirst" class="form-control" placeholder="Nombre">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Apellido</label>
              <input id="citaLast" class="form-control" placeholder="Apellido">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">DNI</label>
              <input id="citaDni" class="form-control" placeholder="Documento">
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Email</label>
              <input id="citaMail" type="email" class="form-control" placeholder="correo@dominio.com">
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <div class="me-auto cita-legend">Selecciona un horario para habilitar la confirmación.</div>
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button id="citaConfirmar" class="btn btn-primary" disabled>Confirmar cita</button>
        </div>
      </div>
    </div>
  </div>
  <!-- =================== FIN MODAL DE CITAS (AGREGADO) =================== -->

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- 
    JavaScript para:
    1) Conmutar pestañas de Divisas / Tasas
    2) Controlar la apertura/maximización del chat
  -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Función de pestañas (Divisas / Tasas)
      function showRatesTab(tab) {
        const tabDivisas = document.getElementById('tabDivisas');
        const tabTasas = document.getElementById('tabTasas');
        const tablaDivisas = document.getElementById('tablaDivisas');
        const tablaTasas = document.getElementById('tablaTasas');
        if (tab === 'divisas') {
          tabDivisas.classList.add('active');
          tabTasas.classList.remove('active');
          tablaDivisas.style.display = '';
          tablaTasas.style.display = 'none';
        } else {
          tabDivisas.classList.remove('active');
          tabTasas.classList.add('active');
          tablaDivisas.style.display = 'none';
          tablaTasas.style.display = '';
        }
      }
      // Exponer la función globalmente para el onclick en HTML
      window.showRatesTab = showRatesTab;

      // Control de la burbuja de chat
      const iframe = document.getElementById('numia-chat-bubble');
      const btn = document.getElementById('max-chat');
      const openBtn = document.getElementById('open-chat');
      let maximized = false;

      // Al hacer clic en la burbuja, mostrar el iframe y el botón de maximizar
      openBtn.onclick = function() {
        iframe.style.display = 'block';
        btn.style.display = 'flex';
        openBtn.style.display = 'none';
      };
      // Al hacer clic en el botón de maximizar/minimizar
      btn.onclick = function() {
        if (!maximized) {
          iframe.style.width = '98vw';
          iframe.style.height = '94vh';
          iframe.style.bottom = '3vh';
          iframe.style.right = '1vw';
          iframe.style.boxShadow = 'none';
          btn.style.bottom = 'calc(94vh + 3vh + 12px)';
          btn.textContent = '🗗';
          maximized = true;
        } else {
          iframe.style.width = '370px';
          iframe.style.height = '550px';
          iframe.style.bottom = '24px';
          iframe.style.right = '24px';
          iframe.style.boxShadow = 'none';
          btn.style.bottom = '590px';
          btn.textContent = '⛶';
          maximized = false;
        }
      };
    });
  </script>

  <!-- ================== JS de la integración de citas (AGREGADO) ================== -->
  <script>
    (function(){
      const API_TOKEN = 's9ZmCOGzuRz0OlxtZyJYIvnG7WQVBtnLlNFrHD2U';
      const SVC_LIST   = 'https://citas2.debmedia.com/api/v2/reducedSchedules';
      const AVAIL_BASE = 'https://citas2.debmedia.com/api/v2/schedules';
      const APPT_URL   = 'https://citas2.debmedia.com/api/v2/appointments';

      // Elementos UI
      const modalEl = document.getElementById('modalCita');
      const modal = new bootstrap.Modal(modalEl);
      const btnPrimaryCards = document.querySelectorAll('.ad-card .btn.btn-primary'); // "Solicitar ahora" (y otros primarios)
      const alertBox = document.getElementById('citaAlert');
      const selSchedule = document.getElementById('citaSchedule');
      const selBranch   = document.getElementById('citaBranch');
      const inputFecha  = document.getElementById('citaFecha');
      const slotsWrap   = document.getElementById('citaSlots');
      const btnConfirm  = document.getElementById('citaConfirmar');

      const inFirst = document.getElementById('citaFirst');
      const inLast  = document.getElementById('citaLast');
      const inDni   = document.getElementById('citaDni');
      const inMail  = document.getElementById('citaMail');

      // Estado actual
      let schedules = [];          // [{id,name,branches:[{id,name},...]}, ...]
      let selectedSlot = null;     // { startAt, endAt, defaultDuration }

      // Habilitar botón "Solicitar ahora" y abrir modal
      // (sin tocar tu HTML original)
      if (btnPrimaryCards && btnPrimaryCards.length) {
        const btnSolicitar = btnPrimaryCards[0]; // el primero es "Solicitar ahora" de la tarjeta de crédito
        btnSolicitar.removeAttribute('disabled');
        btnSolicitar.addEventListener('click', async () => {
          resetForm();
          modal.show();
          await loadSchedules();
        });
      }

      // Utilidades
      const pad = n => String(n).padStart(2,'0');
      const ymd = (d) => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
      function isoFromZonedStart(zonedStartDate) {
        // zonedStartDate viene como "YYYY-MM-DDTHH:mm:ss-0300" o con Z/offset.
        // Para el POST necesitamos startAt y endAt (reusamos el valor recibido + duración).
        // Aquí devolvemos Date para calcular endAt.
        const d = new Date(zonedStartDate);
        return d;
      }
      function setAlert(type, msg){
        // type: 'danger' | 'success' | 'info'
        alertBox.className = `alert alert-${type}`;
        alertBox.textContent = msg;
        alertBox.classList.remove('d-none');
      }
      function clearAlert(){ alertBox.className = 'alert d-none'; alertBox.textContent=''; }

      function resetForm(){
        clearAlert();
        selSchedule.innerHTML = `<option value="">Cargando...</option>`;
        selBranch.innerHTML   = `<option value="">Selecciona un servicio</option>`;
        selBranch.disabled = true;
        inputFecha.value = '';
        inputFecha.disabled = true;
        slotsWrap.innerHTML = '';
        selectedSlot = null;
        btnConfirm.disabled = true;
        inFirst.value = ''; inLast.value = ''; inDni.value = ''; inMail.value = '';
      }

      async function loadSchedules(){
        try{
          const res = await fetch(SVC_LIST, { headers: { 'x-api-token': API_TOKEN } });
          if(!res.ok) throw new Error(`No se pudieron obtener las agendas (${res.status})`);
          schedules = await res.json();

          // Poblar select de agenda
          selSchedule.innerHTML = `<option value="">Selecciona un servicio...</option>`;
          schedules.forEach(s => {
            selSchedule.insertAdjacentHTML('beforeend', `<option value="${s.id}">${s.name}</option>`);
          });

          // Fecha habilitada desde hoy
          const today = new Date();
          inputFecha.min = ymd(today);
          inputFecha.disabled = false;

          // Eventos
          selSchedule.onchange = handleScheduleChange;
          selBranch.onchange = handleBranchOrDateChange;
          inputFecha.onchange = handleBranchOrDateChange;

        }catch(err){
          setAlert('danger', err.message);
        }
      }

      function handleScheduleChange(){
        const schedId = selSchedule.value;
        selBranch.innerHTML = `<option value="">Selecciona sucursal...</option>`;
        selBranch.disabled = true;
        slotsWrap.innerHTML = '';
        btnConfirm.disabled = true;

        if(!schedId){ return; }

        const sched = schedules.find(s => String(s.id) === String(schedId));
        if(!sched || !Array.isArray(sched.branches)) {
          setAlert('danger', 'Esta agenda no tiene sucursales asociadas.');
          return;
        }
        // Poblar sucursales (sin duplicados)
        const seen = new Set();
        sched.branches.forEach(b=>{
          if(!seen.has(b.id)){
            selBranch.insertAdjacentHTML('beforeend', `<option value="${b.id}">${b.name}</option>`);
            seen.add(b.id);
          }
        });
        selBranch.disabled = false;
        clearAlert();
      }

      async function handleBranchOrDateChange(){
        clearAlert();
        slotsWrap.innerHTML = '';
        selectedSlot = null;
        btnConfirm.disabled = true;

        const schedId = selSchedule.value;
        const branchId = selBranch.value;
        const dateStr  = inputFecha.value;

        if(!schedId || !branchId || !dateStr){ return; }

        try{
          const url = `${AVAIL_BASE}/${encodeURIComponent(schedId)}/branch/${encodeURIComponent(branchId)}/availability?strDate=${encodeURIComponent(dateStr)}`;
          const res = await fetch(url, { headers: { 'x-api-token': API_TOKEN }});
          if(!res.ok) throw new Error(`No se pudo obtener disponibilidad (${res.status})`);
          const data = await res.json();

          const slots = Array.isArray(data) ? data : (Array.isArray(data.slots) ? data.slots : []);
          if(slots.length === 0){
            setAlert('info','No hay horarios disponibles para la fecha seleccionada.');
            return;
          }

          // Render de botones
          const frag = document.createDocumentFragment();
          slots.forEach(slot=>{
            const hora = slot.zonedStartDate.substring(11,16);
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'btn btn-light';
            btn.textContent = hora;
            btn.addEventListener('click', ()=>{
              // marcar activo
              [...slotsWrap.querySelectorAll('.btn')].forEach(b=>b.classList.remove('active'));
              btn.classList.add('active');
              // guardar slot seleccionado
              const startDate = isoFromZonedStart(slot.zonedStartDate);
              const end = new Date(startDate.getTime() + (slot.defaultDuration||0) * 60000);
              selectedSlot = {
                startAt: slot.zonedStartDate, // lo mandaremos tal cual
                endAt: end
              };
              btnConfirm.disabled = false;
            });
            frag.appendChild(btn);
          });
          slotsWrap.appendChild(frag);

        }catch(err){
          setAlert('danger', err.message);
        }
      }

      btnConfirm.addEventListener('click', async ()=>{
        clearAlert();
        if(!selectedSlot){
          setAlert('danger','Selecciona un horario primero.');
          return;
        }
        const schedId = selSchedule.value;
        const branchId = selBranch.value;
        if(!schedId || !branchId){
          setAlert('danger','Faltan servicio o sucursal.');
          return;
        }
        // Validaciones mínimas
        if(!inFirst.value || !inLast.value || !inDni.value){
          setAlert('danger','Completa Nombre, Apellido y DNI.');
          return;
        }

        // Construir payload
        const startDate = new Date(selectedSlot.startAt);
        const endDate   = new Date(selectedSlot.endAt);
        const fmt = (d)=>{
          const off = -d.getTimezoneOffset(); // minutos
          const sign = off >= 0 ? '+' : '-';
          const hh = pad(Math.floor(Math.abs(off)/60));
          const mm = pad(Math.abs(off)%60);
          return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}:00${sign}${hh}${mm}`;
        };

        const body = {
          branch:   { id: Number(branchId) },
          schedule: { id: Number(schedId) },
          startAt:  fmt(startDate),
          endAt:    fmt(endDate),
          customer: {
            firstName: inFirst.value,
            lastName:  inLast.value,
            dni:       Number(inDni.value||0),
            email:     inMail.value || undefined
          },
          reason: "Solicitud de Tarjeta de Crédito"
        };

        btnConfirm.disabled = true;
        btnConfirm.textContent = 'Confirmando...';

        try{
          const res = await fetch(APPT_URL, {
            method: 'POST',
            headers: {
              'x-api-token': API_TOKEN,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          });
          const out = await res.json().catch(()=> ({}));
          if(!res.ok){
            throw new Error(out?.message || `Error al crear la cita (${res.status})`);
          }
          setAlert('success', `¡Cita creada! ID: ${out.id || '(recibido)'}`);
          // Cerrar tras unos segundos
          setTimeout(()=> modal.hide(), 1500);
        }catch(err){
          setAlert('danger', err.message);
        }finally{
          btnConfirm.disabled = false;
          btnConfirm.textContent = 'Confirmar cita';
        }
      });
    })();
  </script>
  <!-- ================== FIN JS de la integración de citas (AGREGADO) ================== -->

  <!-- CHAT -->
  <iframe
    src="https://filavirtual.preprod.debmedia.com/Numiabot/#/Ff5h9OOAsmhNELUjk1Dh"
    id="numia-chat-bubble"
    style="
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 370px;
      height: 550px;
      border: none;
      z-index: 9999;
      border-radius: 18px;
      overflow: hidden;
      transition: width 0.3s, height 0.3s, right 0.3s, bottom 0.3s;
      display: none;
    "
    allow="camera; microphone"
  ></iframe>
  <button id="max-chat"
    style="
      position: fixed;
      bottom: 590px;
      right: 24px;
      z-index: 10000;
      background: var(--numia-azul);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 1.6rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    "
    title="Maximizar/minimizar chat"
  >⛶</button>
  <button id="open-chat"
    style="
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 10001;
      background: var(--numia-azul);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      font-size: 2.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    "
    title="Abrir chat"
  >
    <span style="font-weight:bold;font-size:2rem;">N</span>
  </button>
</body>
</html>
